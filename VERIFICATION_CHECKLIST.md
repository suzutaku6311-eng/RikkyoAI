# 動作確認チェックリスト

Supabase設定完了後の動作確認手順です。

---

## ✅ Phase 1: 基本動作確認

### 1.1 アプリケーションの起動確認

- [ ] Vercelのデプロイが成功しているか確認
  - Vercel Dashboard → Deployments → 最新のデプロイが「Ready」になっているか
  - URL: https://rikkyo-ai.vercel.app にアクセスできるか

- [ ] 各ページが正常に表示されるか確認
  - [ ] トップページ (`/`)
  - [ ] 検索ページ (`/ask`)
  - [ ] 文書アップロードページ (`/admin/upload`)
  - [ ] 文書一覧ページ (`/admin/documents`)

### 1.2 RPC関数の動作確認

- [ ] 検索機能をテスト
  1. `/ask` ページにアクセス
  2. 質問を入力（例: "社内規程について教えてください"）
  3. 「🔍 検索」ボタンをクリック
  4. 検索結果が表示されるか確認

- [ ] VercelのログでRPC関数が使用されているか確認
  1. Vercel Dashboard → Deployments → 最新のデプロイ → Functions
  2. `/api/ask` のログを確認
  3. 「RPC関数が存在しないため、クライアント側でベクトル検索を実行します」というメッセージが**表示されない**ことを確認
  4. または、検索速度が速いことを確認（RPC関数使用時は高速）

**期待される動作:**
- 検索結果が数秒以内に表示される
- 類似度スコアが表示される
- 参照文書が表示される

### 1.3 検索履歴機能の確認

- [ ] 検索履歴が保存されるか確認
  1. `/ask` ページで検索を実行
  2. 検索結果が表示された後、「📜 履歴」ボタンをクリック
  3. 履歴パネルに検索履歴が表示されるか確認
  4. 質問と回答が正しく表示されるか確認

- [ ] 履歴からの再検索が動作するか確認
  1. 履歴パネルで過去の質問をクリック
  2. 質問が入力フィールドに設定されるか確認
  3. 回答が表示されるか確認

- [ ] 履歴の削除が動作するか確認
  1. 履歴パネルで「削除」ボタンをクリック
  2. 履歴が削除されるか確認

- [ ] Supabaseでデータが保存されているか確認
  1. Supabase Dashboard → Table Editor → `search_history`
  2. テーブルにデータが保存されているか確認
  3. 最新の検索履歴が表示されるか確認

### 1.4 Storage機能の確認

- [ ] PDFファイルのアップロードが動作するか確認
  1. `/admin/upload` ページにアクセス
  2. PDFファイルを選択
  3. タイトルを入力（オプション）
  4. 「アップロード」ボタンをクリック
  5. アップロードが成功するか確認

- [ ] PDFファイルのダウンロードが動作するか確認
  1. `/admin/documents` ページにアクセス
  2. アップロードした文書の「⬇️ ダウンロード」ボタンをクリック
  3. PDFファイルがダウンロードされるか確認
  4. ファイルが正常に開けるか確認

- [ ] Supabase Storageでファイルが保存されているか確認
  1. Supabase Dashboard → Storage → `documents`
  2. バケット内にファイルが存在するか確認
  3. ファイル名をクリックして、公開URLが表示されるか確認

---

## ✅ Phase 2: パフォーマンス確認

### 2.1 検索速度の確認

- [ ] 検索速度を測定
  - 検索開始から結果表示まで: **3秒以内**が理想
  - RPC関数使用時は**1秒以内**が期待される

- [ ] 複数の検索を連続実行
  - 3〜5回連続で検索を実行
  - すべて正常に動作するか確認
  - エラーが発生しないか確認

### 2.2 UI/UXの確認

- [ ] 木目調デザインが適用されているか確認
  - すべてのページで木目調デザインが表示されるか
  - アニメーションが動作するか

- [ ] 類似度スコアの表示確認
  - 検索結果に類似度スコアが表示されるか
  - プログレスバーが正しく表示されるか
  - パーセンテージが正しく表示されるか

- [ ] ローディング状態の確認
  - 検索中にローディングアニメーションが表示されるか
  - アップロード中にローディング状態が表示されるか

---

## ✅ Phase 3: エラーハンドリング確認

### 3.1 エラーケースのテスト

- [ ] 空の質問で検索
  - 質問を入力せずに検索ボタンをクリック
  - エラーメッセージが表示されるか確認

- [ ] 存在しない文書の検索
  - 文書に含まれていない質問を入力
  - 「関連する文書が見つかりませんでした」と表示されるか確認

- [ ] 大きなファイルのアップロード
  - 5MB以上のPDFファイルをアップロード
  - エラーメッセージが適切に表示されるか確認

### 3.2 ログの確認

- [ ] Vercelのログでエラーがないか確認
  1. Vercel Dashboard → Deployments → 最新のデプロイ → Functions
  2. 各APIエンドポイントのログを確認
  3. エラーログがないか確認

- [ ] Supabaseのログでエラーがないか確認
  1. Supabase Dashboard → Logs
  2. エラーログがないか確認

---

## ✅ Phase 4: データ整合性確認

### 4.1 データベースの確認

- [ ] `documents` テーブルの確認
  1. Supabase Dashboard → Table Editor → `documents`
  2. アップロードした文書が正しく保存されているか確認
  3. `file_path` カラムが正しく設定されているか確認

- [ ] `chunks` テーブルの確認
  1. Supabase Dashboard → Table Editor → `chunks`
  2. チャンクが正しく保存されているか確認
  3. `embedding` カラムが正しく設定されているか確認

- [ ] `search_history` テーブルの確認
  1. Supabase Dashboard → Table Editor → `search_history`
  2. 検索履歴が正しく保存されているか確認
  3. `chunks_used` カラムにJSONデータが保存されているか確認

### 4.2 関数の確認

- [ ] `match_chunks` 関数の確認
  1. Supabase Dashboard → Database → Functions
  2. `match_chunks` 関数が存在するか確認
  3. 関数の定義が正しいか確認

---

## 🐛 トラブルシューティング

### 問題1: 検索結果が0件になる

**確認事項:**
- `chunks` テーブルにデータが存在するか
- `match_chunks` 関数が正しく作成されているか
- Vercelのログでエラーがないか

**解決方法:**
- PDFを再アップロードして、チャンクが作成されるか確認
- RPC関数を再作成

### 問題2: 検索履歴が表示されない

**確認事項:**
- `search_history` テーブルが作成されているか
- Vercelのログでエラーがないか

**解決方法:**
- テーブルを再作成
- ブラウザのコンソールでエラーを確認

### 問題3: PDFファイルがダウンロードできない

**確認事項:**
- `documents` バケットが存在するか
- 公開ポリシーが設定されているか
- `file_path` が正しく設定されているか

**解決方法:**
- Storageバケットとポリシーを再設定
- PDFを再アップロード

---

## 📊 パフォーマンス目標

- **検索速度**: 3秒以内（RPC関数使用時は1秒以内）
- **アップロード速度**: 60秒以内（ファイルサイズによる）
- **ページ読み込み速度**: 2秒以内
- **エラー率**: 1%以下

---

## 🎯 確認完了後の次のステップ

すべての確認が完了したら：

1. **Phase 3の実装を開始**
   - DOCX/TXTファイル対応
   - 高度な検索機能
   - 管理機能の強化

2. **Phase 4の実装を開始**
   - 認証機能の追加
   - 監視・ログ機能

3. **ユーザーフィードバックの収集**
   - 実際のユーザーに使用してもらう
   - フィードバックを収集して改善

---

更新日: 2025-11-26

