# ç®¡ç†è€…æ¨©é™ã®è¨­å®šã‚¬ã‚¤ãƒ‰

adminãªã®ã«æ–‡æ›¸ã®ç®¡ç†ç”»é¢ãŒè¦‹ã‚Œãªã„å ´åˆã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®roleãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ãªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ã“ã®ã‚¬ã‚¤ãƒ‰ã«å¾“ã£ã¦ã€ç®¡ç†è€…æ¨©é™ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚

## ğŸ” å•é¡Œã®ç¢ºèª

### 1. ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’ç¢ºèª

Supabase Dashboard > **ã€ŒSQL Editorã€** ã§ä»¥ä¸‹ã‚’å®Ÿè¡Œï¼š

```sql
-- ç¾åœ¨ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’ç¢ºèª
-- ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å®Ÿéš›ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã«ç½®ãæ›ãˆã¦ãã ã•ã„
SELECT 
  id,
  email,
  name,
  role,
  is_active,
  created_at,
  updated_at
FROM public.user_profiles
WHERE email = 'suzutaku6311@gmail.com';
```

**çµæœã®ç¢ºèª**:
- `role` ãŒ `'user'` ã«ãªã£ã¦ã„ã‚‹å ´åˆ â†’ ã‚¹ãƒ†ãƒƒãƒ—2ã«é€²ã‚“ã§ `'admin'` ã«å¤‰æ›´
- `role` ãŒ `'admin'` ã¾ãŸã¯ `'super_admin'` ã«ãªã£ã¦ã„ã‚‹å ´åˆ â†’ ã‚¹ãƒ†ãƒƒãƒ—3ã«é€²ã‚“ã§ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢
- çµæœãŒç©ºã®å ´åˆ â†’ ã‚¹ãƒ†ãƒƒãƒ—4ã«é€²ã‚“ã§ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’ä½œæˆ

---

## ğŸ”§ è§£æ±ºæ–¹æ³•

### ã‚¹ãƒ†ãƒƒãƒ—1: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®UUIDã‚’å–å¾—

1. Supabase Dashboard > **ã€ŒAuthenticationã€** > **ã€ŒUsersã€** ã‚’é–‹ã
2. ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ `suzutaku6311@gmail.com` ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’æ¢ã™
3. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã® **ã€ŒUUIDã€** ã‚’ã‚³ãƒ”ãƒ¼ï¼ˆä¾‹: `123e4567-e89b-12d3-a456-426614174000`ï¼‰

---

### ã‚¹ãƒ†ãƒƒãƒ—2: roleã‚’'admin'ã«å¤‰æ›´

Supabase Dashboard > **ã€ŒSQL Editorã€** ã§ä»¥ä¸‹ã‚’å®Ÿè¡Œï¼ˆ`YOUR_USER_UUID` ã‚’å®Ÿéš›ã®UUIDã«ç½®ãæ›ãˆï¼‰ï¼š

```sql
-- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®roleã‚’'admin'ã«å¤‰æ›´
UPDATE public.user_profiles
SET 
  role = 'admin',
  updated_at = NOW()
WHERE id = 'YOUR_USER_UUID';
```

**ä¾‹**:
```sql
UPDATE public.user_profiles
SET 
  role = 'admin',
  updated_at = NOW()
WHERE id = '123e4567-e89b-12d3-a456-426614174000';
```

**ç¢ºèª**:
```sql
-- å¤‰æ›´ãŒåæ˜ ã•ã‚ŒãŸã‹ç¢ºèª
SELECT id, email, name, role, is_active
FROM public.user_profiles
WHERE id = 'YOUR_USER_UUID';
```

---

### ã‚¹ãƒ†ãƒƒãƒ—3: ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢

1. ãƒ–ãƒ©ã‚¦ã‚¶ã®é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã‚’é–‹ãï¼ˆF12ï¼‰
2. **ã€ŒApplicationã€** ã‚¿ãƒ–ï¼ˆChromeï¼‰ã¾ãŸã¯ **ã€ŒStorageã€** ã‚¿ãƒ–ï¼ˆFirefoxï¼‰ã‚’é–‹ã
3. **ã€ŒCookiesã€** ã‚’é¸æŠ
4. ã‚µã‚¤ãƒˆã®Cookieã‚’ã™ã¹ã¦å‰Šé™¤
5. ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰ï¼ˆCtrl+Shift+R ã¾ãŸã¯ Cmd+Shift+Rï¼‰

**ã¾ãŸã¯ã€ã‚·ãƒ³ãƒ—ãƒ«ã«**:
- ãƒ–ãƒ©ã‚¦ã‚¶ã§ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
- å†åº¦ãƒ­ã‚°ã‚¤ãƒ³

---

### ã‚¹ãƒ†ãƒƒãƒ—4: ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãŒå­˜åœ¨ã—ãªã„å ´åˆ

ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãŒå­˜åœ¨ã—ãªã„å ´åˆã¯ã€ä»¥ä¸‹ã‚’å®Ÿè¡Œã—ã¦ä½œæˆï¼š

```sql
-- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’ä½œæˆï¼ˆrole = 'admin'ï¼‰
INSERT INTO public.user_profiles (id, email, name, role, is_active)
VALUES (
  'YOUR_USER_UUID',  -- ã‚¹ãƒ†ãƒƒãƒ—1ã§å–å¾—ã—ãŸUUID
  'suzutaku6311@gmail.com',
  'Admin User',  -- è¡¨ç¤ºåï¼ˆä»»æ„ï¼‰
  'admin',  -- ãƒ­ãƒ¼ãƒ«: 'admin' ã¾ãŸã¯ 'super_admin'
  true  -- is_active
)
ON CONFLICT (id) DO UPDATE
SET 
  email = EXCLUDED.email,
  name = EXCLUDED.name,
  role = EXCLUDED.role,
  is_active = EXCLUDED.is_active,
  updated_at = NOW();
```

---

## ğŸ¯ ã‚¹ãƒ¼ãƒ‘ãƒ¼ç®¡ç†è€…æ¨©é™ã‚’è¨­å®šã™ã‚‹å ´åˆ

ã™ã¹ã¦ã®æ©Ÿèƒ½ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚¹ãƒ¼ãƒ‘ãƒ¼ç®¡ç†è€…ã¨ã—ã¦è¨­å®šã™ã‚‹å ´åˆï¼š

```sql
-- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®roleã‚’'super_admin'ã«å¤‰æ›´
UPDATE public.user_profiles
SET 
  role = 'super_admin',
  updated_at = NOW()
WHERE id = 'YOUR_USER_UUID';
```

**ã‚¹ãƒ¼ãƒ‘ãƒ¼ç®¡ç†è€…ã®æ¨©é™**:
- âœ… ã™ã¹ã¦ã®æ–‡æ›¸ã®é–²è¦§ãƒ»ç·¨é›†ãƒ»å‰Šé™¤
- âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ï¼ˆå°†æ¥å®Ÿè£…äºˆå®šï¼‰
- âœ… ã‚·ã‚¹ãƒ†ãƒ è¨­å®šï¼ˆå°†æ¥å®Ÿè£…äºˆå®šï¼‰

---

## ğŸ” ãƒ‡ãƒãƒƒã‚°æ–¹æ³•

### ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ç¢ºèª

1. ãƒ–ãƒ©ã‚¦ã‚¶ã®é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã‚’é–‹ãï¼ˆF12ï¼‰
2. **ã€ŒConsoleã€** ã‚¿ãƒ–ã‚’é–‹ã
3. ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ­ã‚°ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªï¼š

```
[Documents] ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±: { id: '...', email: '...', role: 'admin', isAdmin: true }
[Documents] ç®¡ç†è€…æ¨©é™ã‚’ç¢ºèªã—ã¾ã—ãŸã€‚æ–‡æ›¸ä¸€è¦§ã‚’å–å¾—ã—ã¾ã™ã€‚
```

**ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ãŒè¡¨ç¤ºã•ã‚Œã‚‹å ´åˆ**:
```
[Documents] ç®¡ç†è€…æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ç¾åœ¨ã®role: user
```

ã“ã®å ´åˆã¯ã€ã‚¹ãƒ†ãƒƒãƒ—2ã‚’å®Ÿè¡Œã—ã¦roleã‚’å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚

---

### APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã§ç¢ºèª

ãƒ–ãƒ©ã‚¦ã‚¶ã®é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ« > **ã€ŒNetworkã€** ã‚¿ãƒ–ã§ã€`/api/auth/me` ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ç¢ºèªï¼š

```json
{
  "success": true,
  "user": {
    "id": "...",
    "email": "suzutaku6311@gmail.com",
    "name": "Admin User",
    "role": "admin",  // â† ã“ã“ãŒ 'admin' ã¾ãŸã¯ 'super_admin' ã«ãªã£ã¦ã„ã‚‹ã‹ç¢ºèª
    "is_active": true
  }
}
```

---

## ğŸ“‹ æ¨©é™ã®ç¨®é¡

| ãƒ­ãƒ¼ãƒ« | èª¬æ˜ | ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ãªæ©Ÿèƒ½ |
|--------|------|-------------------|
| `user` | ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼ | `/ask` - æ–‡æ›¸æ¤œç´¢ã®ã¿ |
| `admin` | ç®¡ç†è€… | `/ask` - æ–‡æ›¸æ¤œç´¢<br>`/admin/documents` - æ–‡æ›¸ç®¡ç†<br>`/admin/upload` - æ–‡æ›¸ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ |
| `super_admin` | ã‚¹ãƒ¼ãƒ‘ãƒ¼ç®¡ç†è€… | `admin`ã®ã™ã¹ã¦ã®æ©Ÿèƒ½<br>+ ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ï¼ˆå°†æ¥å®Ÿè£…äºˆå®šï¼‰ |

---

## âœ… ç¢ºèªãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] Supabaseã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®roleãŒ `'admin'` ã¾ãŸã¯ `'super_admin'` ã«ãªã£ã¦ã„ã‚‹
- [ ] ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢ã—ãŸ
- [ ] ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¦å†åº¦ãƒ­ã‚°ã‚¤ãƒ³ã—ãŸ
- [ ] ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ `isAdmin: true` ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] `/api/auth/me` ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã§ `role: "admin"` ãŒè¿”ã£ã¦ãã‚‹
- [ ] ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼ã«ã€Œæ–‡æ›¸ç®¡ç†ã€ã€Œã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã€ã®ãƒªãƒ³ã‚¯ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] `/admin/documents` ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹
- [ ] `/admin/upload` ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹

---

## ğŸ†˜ ã¾ã è§£æ±ºã—ãªã„å ´åˆ

1. **Supabaseã®ãƒ­ã‚°ã‚’ç¢ºèª**
   - Supabase Dashboard > **ã€ŒLogsã€** > **ã€ŒAPI Logsã€** ã‚’ç¢ºèª
   - ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒãªã„ã‹ç¢ºèª

2. **Vercelã®ãƒ­ã‚°ã‚’ç¢ºèª**
   - Vercel Dashboard > ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ > **ã€ŒDeploymentsã€** > æœ€æ–°ã®ãƒ‡ãƒ—ãƒ­ã‚¤ > **ã€ŒFunctionsã€** ã‚¿ãƒ–
   - `/api/auth/me` ã®ãƒ­ã‚°ã‚’ç¢ºèª

3. **ç’°å¢ƒå¤‰æ•°ã‚’å†ç¢ºèª**
   - Vercel Dashboard > **ã€ŒSettingsã€** > **ã€ŒEnvironment Variablesã€**
   - `NEXT_PUBLIC_SUPABASE_URL` ã¨ `NEXT_PUBLIC_SUPABASE_ANON_KEY` ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª

4. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®RLSãƒãƒªã‚·ãƒ¼ã‚’ç¢ºèª**
   - Supabase Dashboard > **ã€ŒAuthenticationã€** > **ã€ŒPoliciesã€**
   - `user_profiles` ãƒ†ãƒ¼ãƒ–ãƒ«ã®RLSãƒãƒªã‚·ãƒ¼ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª

---

## ğŸ”— é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [AUTH_SETUP_GUIDE.md](./AUTH_SETUP_GUIDE.md) - èªè¨¼æ©Ÿèƒ½ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¬ã‚¤ãƒ‰
- [LOGIN_TROUBLESHOOTING.md](./LOGIN_TROUBLESHOOTING.md) - ãƒ­ã‚°ã‚¤ãƒ³ã‚¨ãƒ©ãƒ¼ã®è§£æ±ºã‚¬ã‚¤ãƒ‰

